<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- ãƒªã‚»ãƒƒãƒˆcss -->
    <link rel="stylesheet" href="https://unpkg.com/ress/dist/ress.min.css">
    <!-- é€šå¸¸css -->
    <link rel="stylesheet" href="../static/css/style.css">
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- epoch -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/epoch.min.css') }}">
</head>

<body style="background: url(static/tmp/000001.jpg);">
    <header>
        <h1>AIã™ãƒ–ãƒ¬ã‚¤ã‚¯</h1>
    </header>

    <main>
        <!-- ï¼‘æ®µç›® -->
        <div class="row-contents">
            <div class='content, card' id="videos">
                <h3>ç›¸æ‰‹ç”»é¢</h3>
                <div class="container-b">
                    <div class="video-container" id="video-container">
                        <video width="320" height="240" id="main-stream-video" loop preload autoplay></video>
                        <canvas width="320" height="240" id="main-stream-canvas"></canvas>
                    </div>
                </div>

                <div class="container-b">
                    <div class="btn-toolbar" style="display: flex; justify-content:space-around; flex-direction:row;">
                        <div class="btn-group">
                            <button class="btn btn-outline-dark" id="start-button">ğŸš€ é–‹å§‹</button>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-outline-dark" id="predict-button">ğŸ¤” åˆ†æ</button>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-outline-dark" id="clear-button">âœ¨ åœæ­¢</button>
                        </div>
                    </div>
                </div>

                <div class="container-b" style="display: none;">
                    <div id="faces-container">
                        <canvas height="100" id="faceCanvas" width="100"></canvas>
                    </div>
                </div>

                <div class="container-b">
                    <div class="output">
                        <ul class="list-unstyled" id="console">
                            <li>â‘ é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</li>
                            <li>â‘¡åˆ†æãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</li>
                        </ul>
                    </div>
                </div>

            </div>

            <div class='column-contents, card' style="width: 100%;">
                <h3>è©±é¡Œæ¨è–¦</h3>
                <div class='row-contents'>
                    <div>
                        <h4>Twitterãƒˆãƒ¬ãƒ³ãƒ‰</h4>
                        <ul>
                            {% for trend in trends %}
                            <li>{{trend}}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div>
                        <h4>AIã«ã‚ˆã‚‹æ¨è–¦</h4>
                        <li>é »å‡ºå˜èªï¼š{{ freq }}</li>
                        <li>é–¢é€£å˜èª1ï¼š{{ recommend1 }}</li>
                        <li>é–¢é€£å˜èª2ï¼š{{ recommend2 }}</li>
                    </div>
                </div>

                <div style="display: flex; flex-direction:column; justify-content:center;">

                    <div style="display: flex; flex-direction:row; justify-content:left">
                        <h3>ä¼šè©±</h3>
                        <div style="display: flex; flex-direction:row;">
                            <form action=" /update" method="POST" enctype="multipart/form-data">
                                <button style="display: block; border-radius: 5px;">æ›´æ–°</button>
                            </form>
                            <form action="/startstream" method="POST" enctype="multipart/form-data">
                                <button style="display: block; border-radius: 5px;">é–‹å§‹</button>
                            </form>
                            <form action="/stopstream" method="POST" enctype="multipart/form-data">
                                <button style="display: block;">çµ‚äº†</button>
                            </form>
                        </div>
                    </div>

                    <div id="talk"
                        style="width:90%; height:300px; padding:30px; margin-top:10px; margin:10px; background-color: rgba(248, 245, 209, 1.0); overflow:hidden; overflow-y:scroll; border-radius: 5px;">
                        <p>Aã•ã‚“ï¼štest</p>
                        <p>ã²ã‹ã‚‹ï¼štest</p>
                        <p>Aã•ã‚“ï¼štest</p>
                        <p>Aã•ã‚“ï¼štest</p>
                    </div>

                </div>
            </div>

        </div>

        <!-- äºŒæ®µç›® -->
        <div class='card'>
            <h3>ç››ã‚Šä¸ŠãŒã‚Šåº¦</h3>
            <div id="graph" class="epoch" style="height: 200px;"></div>
        </div>

        <!-- ä¸‰æ®µç›® -->

    </main>

    <footer>
        <p>Â©Suzuki Hikaru's base All Rigths Reserved</p>
    </footer>

    <!-- é¡”èªè­˜ -->
    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/tensorflow.min.js"></script>
    <script src="../static/tracking/build/tracking-min.js"></script>
    <script src="../static/tracking/build/data/face-min.js"></script>
    <script src="../static/tracking/src/alignment/training/Landmarks.js"></script>
    <script src="../static/tracking/src/alignment/training/Regressor.js"></script>
    <script src="../static/js/predict.js"></script>

    <!-- WebSocket -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/epoch.min.js') }}"></script>

    <script type="text/javascript">

        var ws = new WebSocket("ws://localhost:8000/publish");

        var data = [
            { label: "Series 1", values: [] },
            { label: "Series 2", values: [] },
        ];

        // ã‚°ãƒ©ãƒ•ã®è¨­å®š
        var lineChart = $('#graph').epoch({
            type: 'time.line',
            data: data,
            axes: ['left', 'right', 'bottom']
        });

        // ã‚°ãƒ©ãƒ•ã§æ›¸ã
        ws.onmessage = function (msg) {
            var current = JSON.parse(msg.data);
            lineChart.push(current);

            let text = current[0]['y']

            addtalk(1, text)
        };

        function addtalk(user, talktext) {
            let p = `<p>${user}ï¼š${talktext}</p>`;
            document.getElementById('talk').insertAdjacentHTML('afterbegin', p);
        }

    </script>

</body>

</html>